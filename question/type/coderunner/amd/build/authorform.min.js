define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b,c){var d=a("#id_"+b).is(":visible")||a("#id_"+b+"_wrapper").is(":visible");"undefined"==typeof c&&(c=o.prop("value")?o.prop("value"):n.prop("value")),m.prop("checked")&&d&&require(["qtype_coderunner/aceinterface"],function(a){a.initAce("id_"+b,c.toLowerCase())})}function c(a){var c=a?"block":"none";q.css("display",c),r.css("display",c),a&&b("template",n.prop("value"))}function e(b,e){var f,h,i;for(var j in d)f=d[j],h=e[j]?e[j]:f[2],f.length>3&&(i=f[3],h=i(h)),a(f[0]).prop(f[1],h);v.prop("value",b),p.prop("checked",!1),x.html(g(b,e.questiontext)),c(!1)}function f(a,b){var c;window.alert(h("prototype_load_failure")+b),c=h("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+w+", qtype: "+a,l.prop("value",c)}function g(a,b){var c='<p class="question-type-details-header">';return c+=h("coderunner_question_type"),c+=a+"</p>\n"+b}function h(a){return M.util.get_string(a,"qtype_coderunner")}function i(){var b=k.children("option:selected").text();""!==b&&"Undefined"!==b&&(k.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:w,sesskey:M.cfg.sesskey},function(a){a.success?e(b,a):f(b,a.error)}).fail(function(){window.alert(h("error_loading_prototype")),l.prop("value",h("ajax_error"))}))}function j(){"3"===y.val()?z.show():z.hide()}var k=a("#id_coderunnertype"),l=a("#id_template"),m=a("#id_useace"),n=a("#id_language"),o=a("#id_acelang"),p=a("#id_customise"),q=a("#id_customisationheader"),r=a("#id_advancedcustomisationheader"),s=p.prop("checked"),t=a("#id_prototypetype"),u=a("#id_answerpreloadhdr"),v=a("#id_typename"),w=a('input[name="courseid"]').prop("value"),x=a("#qtype-help"),y=a("select#id_precheck"),z=a("div.testtype");1==t.prop("value")&&(window.alert(h("proceed_at_own_risk")),t.prop("disabled",!0),k.prop("disabled",!0),p.prop("disabled",!0)),b("answer"),b("answerpreload"),c(s),s?x.html("<p>"+h("info_unavailable")+"</p>"):i(),j(),p.on("change",function(){var a=p.prop("checked");a?c(!0):window.confirm(h("confirm_proceed"))?c(!1):p.prop("checked",!0)}),o.on("change",function(){b("answer"),b("answerpreload")}),k.on("change",function(){p.prop("checked")&&!window.confirm(h("question_type_changed"))||i()}),m.on("change",function(){var a=m.prop("checked");a?(b("template",n.prop("value")),b("answer"),b("answerpreload")):require(["qtype_coderunner/aceinterface"],function(a){a.stopUsingAce()})}),y.on("change",j);var A=new MutationObserver(function(){b("answerpreload")});A.observe(u.get(0),{attributes:!0})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""]};return{initEditForm:b}});